<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Tanuki' %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: white;
        }
        .card {
            transition: background-color 0.3s ease, transform 0.3s ease;
        }
        .card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 0.5rem;
            transition: transform 0.3s ease;
        }
        .card p {
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        .card:hover {
            background-color: #1a1a1a;
            transform: translateY(-3px);
        }
        .card:hover img {
            transform: scale(1.03);
        }
        .card:hover p {
            opacity: 1;
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="bg-black border-b border-neutral-800 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center space-x-8">
                <h1 class="text-2xl font-bold text-orange-500 cursor-pointer" onclick="location.href='/'">Tanuki</h1>
                <div class="hidden md:flex space-x-2">
                    <a href="/" class="px-3 py-2 rounded-md font-semibold <%= currentPage === 'biblioteca' ? 'bg-orange-500 text-white' : 'text-neutral-300 hover:bg-neutral-800 hover:text-orange-400' %>">
                        Biblioteca
                    </a>
                    <a href="/communities" class="px-3 py-2 rounded-md font-semibold <%= currentPage === 'comunidades' ? 'bg-orange-500 text-white' : 'text-neutral-300 hover:bg-neutral-800 hover:text-orange-400' %>">
                        Comunidades
                    </a>
                    <a href="/scan-groups" class="px-3 py-2 rounded-md font-semibold <%= currentPage === 'grupos' ? 'bg-orange-500 text-white' : 'text-neutral-300 hover:bg-neutral-800 hover:text-orange-400' %>">
                        Grupos
                    </a>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <input 
                        type="text" 
                        id="searchInput"
                        placeholder="Buscar..." 
                        class="bg-neutral-900 text-white px-4 py-2 rounded-lg w-64 focus:outline-none focus:ring-2 focus:ring-orange-500"
                    >
                    <span class="absolute right-4 top-2.5 text-neutral-400">⌕</span>
                </div>
                <% if (user) { %>
                    <div class="flex items-center space-x-2">
                        <img src="<%= user.avatar || '/default-avatar.png' %>" alt="<%= user.username %>" class="w-8 h-8 rounded-full">
                        <span class="text-white"><%= user.username %></span>
                        <a href="/logout" class="text-orange-500 hover:underline">Cerrar sesión</a>
                    </div>
                <% } else { %>
                    <a href="/login" class="text-orange-500 hover:underline font-semibold">Iniciar sesión</a>
                <% } %>
            </div>
        </div>
    </div>
</nav>

<!-- Contenido dinámico -->
<div class="max-w-7xl mx-auto px-4 py-6">
    <h2 class="text-2xl font-bold mb-4">
        <%= currentPage === 'biblioteca' ? 'Biblioteca' : currentPage === 'comunidades' ? 'Comunidades' : 'Grupos' %>
    </h2>
    <div id="itemsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        <% if (currentPage === 'biblioteca') { %>
            <% mangas.forEach(item => { %>
                <div class="card bg-neutral-900 p-4 rounded-lg">
                    <img src="<%= item.cover %>" alt="<%= item.title %>">
                    <h3 class="text-lg font-semibold mt-3"><%= item.title %></h3>
                    <p class="text-sm text-neutral-400 mt-1"><%= item.description %></p>
                </div>
            <% }) %>
        <% } else if (currentPage === 'comunidades') { %>
            <% communities.forEach(item => { %>
                <div class="card bg-neutral-900 p-4 rounded-lg">
                    <img src="<%= item.cover %>" alt="<%= item.name %>">
                    <h3 class="text-lg font-semibold mt-3"><%= item.name %></h3>
                    <p class="text-sm text-neutral-400 mt-1"><%= item.description %></p>
                </div>
            <% }) %>
        <% } else if (currentPage === 'grupos') { %>
            <% groups.forEach(item => { %>
                <div class="card bg-neutral-900 p-4 rounded-lg">
                    <img src="<%= item.cover %>" alt="<%= item.name %>">
                    <h3 class="text-lg font-semibold mt-3"><%= item.name %></h3>
                    <p class="text-sm text-neutral-400 mt-1"><%= item.description %></p>
                </div>
            <% }) %>
        <% } %>
    </div>
</div>

<script>
const searchInput = document.getElementById("searchInput");
const itemsContainer = document.getElementById("itemsContainer");
const currentPage = "<%= currentPage %>";

searchInput.addEventListener("input", function() {
    const q = this.value.trim();
    let apiUrl = "";

    if (currentPage === "biblioteca") {
        apiUrl = `/api/search/mangas?q=${encodeURIComponent(q)}`;
    } else if (currentPage === "comunidades") {
        apiUrl = `/api/search/communities?q=${encodeURIComponent(q)}`;
    } else if (currentPage === "grupos") {
        apiUrl = `/api/search/groups?q=${encodeURIComponent(q)}`;
    }

    fetch(apiUrl)
        .then(res => res.json())
        .then(items => {
            itemsContainer.innerHTML = "";
            items.forEach(item => {
                itemsContainer.innerHTML += `
                    <div class="card bg-neutral-900 p-4 rounded-lg">
                        <img src="${item.cover}" alt="${item.title || item.name}">
                        <h3 class="text-lg font-semibold mt-3">${item.title || item.name}</h3>
                        <p class="text-sm text-neutral-400 mt-1">${item.description}</p>
                    </div>
                `;
            });
        });
});
</script>

</body>
</html>
